(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{728:function(e,t,o){"use strict";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
function n(e,t,o,n){return new(o||(o=Promise))((function(r,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function d(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?r(e.value):new o((function(t){t(e.value)})).then(s,d)}c((n=n.apply(e,t||[])).next())}))}o.r(t),o.d(t,"platformConnectionFactory",(function(){return v}));var r,i,s,d,c;!function(e){e.Call="call",e.Reply="reply",e.Syn="syn",e.SynAck="synAck",e.Ack="ack"}(r||(r={})),function(e){e.Fulfilled="fulfilled",e.Rejected="rejected"}(i||(i={})),function(e){e.ConnectionDestroyed="ConnectionDestroyed",e.ConnectionTimeout="ConnectionTimeout",e.NotInIframe="NotInIframe",e.NoIframeSrc="NoIframeSrc"}(s||(s={})),function(e){e.DataCloneError="DataCloneError"}(d||(d={})),function(e){e.Message="message"}(c||(c={}));const a=({name:e,message:t,stack:o})=>({name:e,message:t,stack:o});let u=0;var l=()=>++u,m=(e,t,o,n,d)=>{const{localName:a,local:u,remote:m,originForSending:p,originForReceiving:f}=t;let v=!1;d(a+": Connecting call sender");const h=e=>(...t)=>{let o;d(`${a}: Sending ${e}() call`);try{m.closed&&(o=!0)}catch(e){o=!0}if(o&&n(),v){const t=new Error(`Unable to send ${e}() call due to destroyed connection`);throw t.code=s.ConnectionDestroyed,t}return new Promise((o,n)=>{const s=l(),v=t=>{if(t.source!==m||t.data.penpal!==r.Reply||t.data.id!==s)return;if(t.origin!==f)return void d(`${a} received message from origin ${t.origin} which did not match expected origin ${f}`);const l=t.data;d(`${a}: Received ${e}() reply`),u.removeEventListener(c.Message,v);let p=l.returnValue;l.returnValueIsError&&(p=(e=>{const t=new Error;return Object.keys(e).forEach(o=>t[o]=e[o]),t})(p)),(l.resolution===i.Fulfilled?o:n)(p)};u.addEventListener(c.Message,v);const h={penpal:r.Call,id:s,methodName:e,args:t};m.postMessage(h,p)})};return o.reduce((e,t)=>(e[t]=h(t),e),e),()=>{v=!0}},p=(e,t,o,n)=>{const{destroy:s,onDestroy:u}=o;return o=>{if(!(e instanceof RegExp?e.test(o.origin):"*"===e||e===o.origin))return void n(`Child: Handshake - Received SYN-ACK from origin ${o.origin} which did not match expected origin ${e}`);n("Child: Handshake - Received SYN-ACK, responding with ACK");const l="null"===o.origin?"*":o.origin,p={penpal:r.Ack,methodNames:Object.keys(t)};window.parent.postMessage(p,l);const f={localName:"Child",local:window,remote:window.parent,originForSending:l,originForReceiving:o.origin},v=((e,t,o)=>{const{localName:n,local:s,remote:u,originForSending:l,originForReceiving:m}=e;let p=!1;const f=e=>{if(e.source!==u||e.data.penpal!==r.Call)return;if(e.origin!==m)return void o(`${n} received message from origin ${e.origin} which did not match expected origin ${m}`);const s=e.data,{methodName:c,args:f,id:v}=s;o(`${n}: Received ${c}() call`);const h=e=>t=>{if(o(`${n}: Sending ${c}() reply`),p)return void o(`${n}: Unable to send ${c}() reply due to destroyed connection`);const s={penpal:r.Reply,id:v,resolution:e,returnValue:t};e===i.Rejected&&t instanceof Error&&(s.returnValue=a(t),s.returnValueIsError=!0);try{u.postMessage(s,l)}catch(e){if(e.name===d.DataCloneError){const t={penpal:r.Reply,id:v,resolution:i.Rejected,returnValue:a(e),returnValueIsError:!0};u.postMessage(t,l)}throw e}};new Promise(e=>e(t[c].apply(t,f))).then(h(i.Fulfilled),h(i.Rejected))};return s.addEventListener(c.Message,f),()=>{p=!0,s.removeEventListener(c.Message,f)}})(f,t,n);u(v);const h={},y=m(h,f,o.data.methodNames,s,n);return u(y),h}};var f=(e={})=>{const{parentOrigin:t="*",methods:o={},timeout:n,debug:i=!1}=e,d=(e=>(...t)=>{e&&console.log("[Penpal]",...t)})(i),a=(()=>{const e=[];let t=!1;return{destroy(o){t=!0,e.forEach(e=>{e(o)})},onDestroy(o){t?o():e.push(o)}}})(),{destroy:u,onDestroy:l}=a;(()=>{if(window===window.top){const e=new Error("connectToParent() must be called within an iframe");throw e.code=s.NotInIframe,e}})();const m=p(t,o,a,d);return{promise:new Promise((e,o)=>{const i=((e,t)=>{let o;return void 0!==e&&(o=window.setTimeout(()=>{const o=new Error(`Connection timed out after ${e}ms`);o.code=s.ConnectionTimeout,t(o)},e)),()=>{clearTimeout(o)}})(n,u),a=t=>{if((()=>{try{clearTimeout()}catch(e){return!1}return!0})()&&t.source===parent&&t.data&&t.data.penpal===r.SynAck){const o=m(t);o&&(window.removeEventListener(c.Message,a),i(),e(o))}};window.addEventListener(c.Message,a),(()=>{d("Child: Handshake - Sending SYN");const e={penpal:r.Syn},o=t instanceof RegExp?"*":t;window.parent.postMessage(e,o)})(),l(e=>{window.removeEventListener(c.Message,a),e||((e=new Error("Connection destroyed")).code=s.ConnectionDestroyed),o(e)})}),destroy(){u()}}};const v=()=>{let e=()=>{throw new Error("onSplashScreenCompleted must be set.")};const t=document.referrer&&new URL(document.referrer),o=t?t.protocol+"//"+t.host:/i-ready.com(:\d+)?$/,r=f({parentOrigin:o,methods:{loaderCompleted(){return n(this,void 0,void 0,(function*(){e()}))}}});return r.promise.catch(()=>console.error("disconnected from platform before making connection")),{preferences:{fetch(){return n(this,void 0,void 0,(function*(){return(yield r.promise).preferencesFetch()}))},update(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).preferencesUpdate(e)}))}},settings:{fetch(){return n(this,void 0,void 0,(function*(){return(yield r.promise).settingsFetch()}))}},stateStore:{save(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).stateStoreSave(e)}))},fetch(){return n(this,void 0,void 0,(function*(){return(yield r.promise).stateStoreFetch()}))},delete(){return n(this,void 0,void 0,(function*(){return(yield r.promise).stateStoreDelete()}))},mark(e,t){return n(this,void 0,void 0,(function*(){localStorage.setItem(e,JSON.stringify(t))}))},jump(e){const t=localStorage.getItem(e);t&&this.save(JSON.parse(t)).then(()=>window.location.reload())}},loader:{setProgress(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).loaderSetProgress(e)}))},setCredits(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).loaderSetCredits(e)}))},onCompleted(t){e=t}},student:{fetch(){return n(this,void 0,void 0,(function*(){return(yield r.promise).studentFetch()}))}},activity:{fetch(){return n(this,void 0,void 0,(function*(){return(yield r.promise).activityFetch()}))}},component:{start(){return n(this,void 0,void 0,(function*(){return(yield r.promise).componentStart()}))},pause(){return n(this,void 0,void 0,(function*(){return(yield r.promise).componentPause()}))},resume(){return n(this,void 0,void 0,(function*(){return(yield r.promise).componentResume()}))},close(){return n(this,void 0,void 0,(function*(){return(yield r.promise).componentClose()}))},complete(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).componentComplete(e)}))}},learnosity:{start(){return n(this,void 0,void 0,(function*(){return(yield r.promise).learnosityStart()}))},complete(){return n(this,void 0,void 0,(function*(){return(yield r.promise).learnosityComplete()}))},close(){return n(this,void 0,void 0,(function*(){return(yield r.promise).learnosityClose()}))}},fluency:{makeHttpRequest(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).fluencyMakeHttpRequest(e)}))},complete(){return n(this,void 0,void 0,(function*(){return(yield r.promise).fluencyComplete()}))},close(){return n(this,void 0,void 0,(function*(){return(yield r.promise).fluencyClose()}))}},dataCapture:{config(){return n(this,void 0,void 0,(function*(){return(yield r.promise).dataCaptureConfig()}))}},remoteLogger:{error(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).remoteLoggerError(e)}))},fatal(e){return n(this,void 0,void 0,(function*(){return(yield r.promise).remoteLoggerFatal(e)}))}},ready(){return n(this,void 0,void 0,(function*(){yield r.promise}))},close(){try{r.destroy()}catch(e){}}}}}}]);
